<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Salty</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classSalty.html">Salty</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="classSalty.html">Salty</a> is a drop-in replacement for (some of) <a href="https://github.com/typicaljoe/taffydb">TaffyDB</a>. It supports only the TaffyDB features that JSDoc has historically used.</p>
<h1><a class="anchor" id="autotoc_md812"></a>
Why Salty?</h1>
<p>TaffyDB lets you query an array of objects, similar to the way you would query a database. JSDoc 3.x used TaffyDB to manage <em>doclets</em>, or objects that contain information about your code.</p>
<p>Specifically, after JSDoc parsed your code, it passed the doclets to your JSDoc template as a TaffyDB object. The template then used TaffyDB queries to remove unneeded doclets, and to retrieve the doclets that were needed to generate documentation.</p>
<p><a class="el" href="classSalty.html">Salty</a> exists because TaffyDB is no longer maintained and is the subject of a <a href="https://www.cve.org/CVERecord?id=CVE-2019-10790">CVE</a>, causing TaffyDB to be flagged as a security risk. There's no real security risk, but it sure looks like there is.</p>
<p>Also, TaffyDB <a href="https://github.com/typicaljoe/taffydb/issues/166">can't decide what license it uses</a>:</p>
<ul>
<li>The <a href="https://github.com/typicaljoe/taffydb/blame/d4870cee370abffe510ba598b02e4e7ad6af5d2a/README.md#L146-L156">README</a> says that TaffyDB uses the <a href="https://opensource.org/licenses/BSD-1-Clause">1-clause BSD License</a>.</li>
<li>The <a href="https://github.com/typicaljoe/taffydb/blob/d4870cee370abffe510ba598b02e4e7ad6af5d2a/package.json#L32"><code>package.json</code> file</a> says that TaffyDB uses the <a href="https://opensource.org/licenses/BSD-2-Clause">2-clause BSD License</a>.</li>
<li>The <a href="https://github.com/typicaljoe/taffydb/blob/d4870cee370abffe510ba598b02e4e7ad6af5d2a/License"><code>License</code> file</a> says that TaffyDB uses the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</li>
</ul>
<p>By replacing TaffyDB with <a class="el" href="classSalty.html">Salty</a>, which uses the <a href="https://github.com/jsdoc/jsdoc/blob/main/packages/jsdoc-salty/LICENSE">Apache 2.0 License</a>, JSDoc resolved the purported security issue and the licensing uncertainty.</p>
<h1><a class="anchor" id="autotoc_md813"></a>
Use Salty in a JSDoc template</h1>
<p>Starting in version 4.0.0, JSDoc no longer uses the <code>taffydb</code> package as a dependency. If you use a JSDoc template that comes with JSDoc 4.0.0 or later, then you don't need to make any changes to the template.</p>
<p>Otherwise, your template might use the <code>taffydb</code> package. After you replace <code>taffydb</code> with <code>@jsdoc/salty</code>, your template should remain compatible with JSDoc 3.x.</p>
<p>To replace <code>taffydb</code> with <code>@jsdoc/salty</code>, do the following:</p>
<ol type="1">
<li><p class="startli">In the template's <code>publish.js</code> file, find the line or lines that require <code>taffydb</code>. They should look similar to one of the following:</p>
<p class="startli">``<code>js // Old-school, without object destructuring (might use</code>var<code>or</code>let<code>instead of</code>const&lsquo;) const taffy = require('taffydb&rsquo;).taffy; // New-school, with object destructuring const { taffy } = require('taffydb'); ```</p>
</li>
<li><p class="startli">Replace <code>taffydb</code> with <code>@jsdoc/salty</code>:</p>
<p class="startli">```js // Old-school, without object destructuring const taffy = require('@jsdoc/salty').taffy; // New-school, with object destructuring const { taffy } = require('@jsdoc/salty'); ```</p>
</li>
<li>If the template has a <code>package.json</code> file that includes <code>taffydb</code> as a dependency, then remove the <code>taffydb</code> dependency.</li>
<li>In the template's <code>package.json</code> file, add <code>@jsdoc/salty</code> as a dependency.</li>
<li>Run <code>npm install</code> in the template directory, then confirm that the template works as expected.</li>
</ol>
<h1><a class="anchor" id="autotoc_md814"></a>
Supported TaffyDB features</h1>
<p><a class="el" href="classSalty.html">Salty</a> supports only the TaffyDB features that have historically been used by JSDoc templates. That means that most TaffyDB functionality is missing.</p>
<p>Specifically, <a class="el" href="classSalty.html">Salty</a> lets you do the following:</p>
<h2><a class="anchor" id="autotoc_md815"></a>
Create a database</h2>
<div class="fragment"><div class="line">let db = taffy([{ <a class="code" href="resolve_2test_2resolver_2nested__symlinks_2mylib_2async_8js.html#a82ca4ee5dd63e58a2bb967077dc8b8fb">a</a>: 3 }, { <a class="code" href="resolve_2test_2resolver_2nested__symlinks_2mylib_2async_8js.html#a82ca4ee5dd63e58a2bb967077dc8b8fb">a</a>: 1, <a class="code" href="markdown-it_8min_8js.html#aa4026ad5544b958e54ce5e106fa1c805">b</a>: <span class="stringliteral">&#39;hello&#39;</span> }, { <a class="code" href="resolve_2test_2resolver_2nested__symlinks_2mylib_2async_8js.html#a82ca4ee5dd63e58a2bb967077dc8b8fb">a</a>: 7, <a class="code" href="markdown-it_8min_8js.html#aa4026ad5544b958e54ce5e106fa1c805">b</a>: 2 }]);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md816"></a>
Sort items in a database</h2>
<p>Items are sorted in place. <a class="el" href="classSalty.html">Salty</a> uses the following sort order, which differs from, but is more predictable than, TaffyDB:</p>
<ol type="1">
<li>Non-null, non-undefined values, in standard sort order</li>
<li>Null values</li>
<li>Explicitly undefined values: key is present, value is undefined</li>
<li>Implicitly undefined values: key is not present</li>
</ol>
<div class="fragment"><div class="line"><span class="comment">// Sort by the `a` property</span></div>
<div class="line">db.sort(<span class="charliteral">&#39;a&#39;</span>);</div>
<div class="line"><span class="comment">// Sort by the `a` property, then the `b` property</span></div>
<div class="line">db.sort(<span class="stringliteral">&#39;a, b&#39;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md817"></a>
Get items from a database</h2>
<p>```js // Get array of all items const emptyMatcher = db().<a class="el" href="__baseAt_8js.html#a2ec270f2dfe59f7a82f3a32bfdb40580">get()</a>; // Get array of items where <code>a</code> is either <code>1</code> or <code>3</code> const arrayMatcher = db({ a: [1, 3] }).<a class="el" href="__baseAt_8js.html#a2ec270f2dfe59f7a82f3a32bfdb40580">get()</a>; // Get array of items where <code>a</code> is <code>1</code> and <code>b</code> is <code>hello</code> const multiMatcher = db({ a: 1 }, { b: 'hello' }).<a class="el" href="__baseAt_8js.html#a2ec270f2dfe59f7a82f3a32bfdb40580">get()</a>; // Get array of items where <code>b</code> is undefined const undefinedMatcher = db({ b: { isUndefined: true } }).<a class="el" href="__baseAt_8js.html#a2ec270f2dfe59f7a82f3a32bfdb40580">get()</a>; ```</p>
<h2><a class="anchor" id="autotoc_md818"></a>
Get items with a custom query function</h2>
<p>Within the query function, <code>this</code> is bound to the current item. As a result, the custom query function cannot be an arrow function.</p>
<p>```js function query() { return this.a &gt; 1; }</p>
<p>const items = db(query).<a class="el" href="__baseAt_8js.html#a2ec270f2dfe59f7a82f3a32bfdb40580">get()</a>; // <code>items</code> is <code>[{ a: 3 }, { a: 7, b: 2 }]</code> ```</p>
<h2><a class="anchor" id="autotoc_md819"></a>
Iterate over items in a database</h2>
<p>```js // Iterate over all items db().each((item, i) =&gt; console.log(&lsquo;'b&rsquo; property at index ${i}: ${item.b}<code>)); // Iterate over items where</code>b<code>equals</code>hello&lsquo; db({ b: 'hello&rsquo; }).each((item) =&gt; console.log(&lsquo;'a&rsquo; property: ${item.a}<code>)); </code>``</p>
<h2><a class="anchor" id="autotoc_md820"></a>
Remove items from a database</h2>
<p>``<code>js // Remove items where</code>a<code>equals</code>7<code> db({ a: 7 }).<a class="el" href="_0dcodemirror_2state_2dist_2index_8js.html#ac7e9ef6f325a9eb756e323c8cc6168e8">remove()</a>; // returns</code>1<code>(the number of items removed) // Remove items where</code>b<code>is undefined db({ b: { isUndefined: true } }).<a class="el" href="_0dcodemirror_2state_2dist_2index_8js.html#ac7e9ef6f325a9eb756e323c8cc6168e8">remove()</a>; // returns</code>1` // Remove all items db().<a class="el" href="_0dcodemirror_2state_2dist_2index_8js.html#ac7e9ef6f325a9eb756e323c8cc6168e8">remove()</a>; ```</p>
<h1><a class="anchor" id="autotoc_md821"></a>
New features</h1>
<p><a class="el" href="classSalty.html">Salty</a> probably won't gain any new features, ever. It exists solely to meet the requirements of JSDoc.</p>
<p>The exception is if a JSDoc template uses TaffyDB features that aren't available in <a class="el" href="classSalty.html">Salty</a>. If that's the case, <a href="https://github.com/jsdoc/jsdoc/issues">create an issue</a> with details about the template you're using and the feature that's missing.</p>
<h1><a class="anchor" id="autotoc_md822"></a>
TaffyDB, JSDoc, and security</h1>
<p>Is TaffyDB a security risk? And has JSDoc ever used TaffyDB in a way that creates a security risk? The answer to both questions is no.</p>
<p>First, <a href="https://www.cve.org/CVERecord?id=CVE-2019-10790">CVE-2019-10790</a> says that "attackers can
use [the TaffyDB] vulnerability to access any data items in the DB." But JSDoc used TaffyDB only to store data about your JavaScript code. That data is no more sensitive than the code itself.</p>
<p>Also, JSDoc doesn't persist the TaffyDB data to disk. It exists only while JSDoc is running.</p>
<p>Most important of all, TaffyDB doesn't pretend to have any sort of access control. To the contrary, TaffyDB <em>intentionally</em> makes it very easy to access all of the data in a DB. If your DB is stored in a variable named <code>db</code>, then calling <code>db().<a class="el" href="__baseAt_8js.html#a2ec270f2dfe59f7a82f3a32bfdb40580">get()</a></code> retrieves all of the data in the DB. <a href="https://taffydb.com/working_with_data.html">This method is documented</a> as the "[p]refered [sic]
method for extracting data." Because you can always access <em>all</em> of the data, it's unclear why a bug that lets you access <em>some</em> of the data would create a security risk.</p>
<p>So <a class="el" href="classSalty.html">Salty</a> doesn't mitigate a security risk or fix a security issue. However, in general, it's not a good idea to tell people to ignore CVEs; also, it can be difficult to convince your colleagues or employer to ignore a specific CVE. For those reasons, it was worth the trouble to replace TaffyDB.</p>
<h1><a class="anchor" id="autotoc_md823"></a>
What's with the name?</h1>
<p>It's a play on "saltwater taffy." Hilarious! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="amarkdown-it_8min_8js_html_aa4026ad5544b958e54ce5e106fa1c805"><div class="ttname"><a href="markdown-it_8min_8js.html#aa4026ad5544b958e54ce5e106fa1c805">b</a></div><div class="ttdeci">var b</div><div class="ttdef"><b>Definition:</b> markdown-it.min.js:2</div></div>
<div class="ttc" id="aresolve_2test_2resolver_2nested__symlinks_2mylib_2async_8js_html_a82ca4ee5dd63e58a2bb967077dc8b8fb"><div class="ttname"><a href="resolve_2test_2resolver_2nested__symlinks_2mylib_2async_8js.html#a82ca4ee5dd63e58a2bb967077dc8b8fb">a</a></div><div class="ttdeci">var a</div><div class="ttdef"><b>Definition:</b> async.js:1</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
