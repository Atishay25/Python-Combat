<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Node.js - klaw</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Node.js - klaw </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://standardjs.com" style="float: right; padding: 0 0 20px 20px;"><object type="image/svg+xml" data="https://cdn.rawgit.com/feross/standard/master/sticker.svg" style="pointer-events: none;" width="100" align="right">JavaScript Standard Style</object></a></p>
<p>A Node.js file system walker extracted from <a href="https://github.com/jprichardson/node-fs-extra">fs-extra</a>.</p>
<p><a href="https://www.npmjs.org/package/klaw"><object type="image/svg+xml" data="https://img.shields.io/npm/v/klaw.svg?style=flat-square" style="pointer-events: none;">npm Package</object></a> <a href="http://travis-ci.org/jprichardson/node-klaw"><object type="image/svg+xml" data="https://api.travis-ci.org/jprichardson/node-klaw.svg" style="pointer-events: none;">build status</object></a> <a href="https://ci.appveyor.com/project/jprichardson/node-klaw/branch/master"><img src="https://ci.appveyor.com/api/projects/status/github/jprichardson/node-klaw?branch=master&amp;svg=true" alt="windows build status" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md634"></a>
Install</h1>
<pre class="fragment">npm i --save klaw
</pre><p>If you're using Typescript, we've got <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/11492/files">types</a>: </p><pre class="fragment">npm i --save-dev @types/klaw
</pre><h1><a class="anchor" id="autotoc_md635"></a>
Name</h1>
<p><code>klaw</code> is <code>walk</code> backwards :p</p>
<h1><a class="anchor" id="autotoc_md636"></a>
Sync</h1>
<p>If you need the same functionality but synchronous, you can use <a href="https://github.com/manidlou/node-klaw-sync">klaw-sync</a>.</p>
<h1><a class="anchor" id="autotoc_md637"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md638"></a>
klaw(directory, [options])</h2>
<p>Returns a <a href="https://nodejs.org/api/stream.html#stream_class_stream_readable">Readable stream</a> that iterates through every file and directory starting with <code>dir</code> as the root. Every <code>read()</code> or <code>data</code> event returns an object with two properties: <code>path</code> and <code>stats</code>. <code>path</code> is the full path of the file and <code>stats</code> is an instance of <a href="https://nodejs.org/api/fs.html#fs_class_fs_stats">fs.Stats</a>.</p>
<ul>
<li><code>directory</code>: The directory to recursively walk. Type <code>string</code>.</li>
<li><code>options</code>: <a href="https://nodejs.org/api/stream.html#stream_new_stream_readable_options">Readable stream options</a> and the following:<ul>
<li><code>queueMethod</code> (<code>string</code>, default: &lsquo;'shift&rsquo;<code>): Either</code>'shift'<code>or</code>'pop'<code>. On</code>readdir()<code>array, call either</code>shift()<code>or</code>pop()<code>. -</code>pathSorter<code>(</code>function<code>, default:</code>undefined<code>): Sorting [function for Arrays](<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort</a>). -</code>fs<code>(</code>object<code>, default: [</code>graceful-fs<code>](<a href="https://github.com/isaacs/node-graceful-fs">https://github.com/isaacs/node-graceful-fs</a>)): Use this to hook into the</code>fs<code>methods or to use [</code>mock-fs<code>](<a href="https://github.com/tschaub/mock-fs">https://github.com/tschaub/mock-fs</a>) -</code>filter<code>(</code>function<code>, default:</code>undefined<code>): Filtering [function for Arrays](<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter</a>) -</code>depthLimit<code>(</code>number<code>, default:</code>undefined<code>): The number of times to recurse before stopping. -1 for unlimited. -</code>preserveSymlinks<code>(</code>boolean<code>, default:</code>false`): Whether symlinks should be followed or treated as items themselves. If true, symlinks will be returned as items in their own right. If false, the linked item will be returned and potentially recursed into, in its stead.</li>
</ul>
</li>
</ul>
<p><b>Streams 1 (push) example:</b></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> klaw = require(<span class="stringliteral">&#39;klaw&#39;</span>)</div>
<div class="line"> </div>
<div class="line">const items = [] <span class="comment">// files, directories, symlinks, etc</span></div>
<div class="line">klaw(&#39;/some/dir&#39;)</div>
<div class="line">  .on(&#39;data&#39;, item =&gt; items.push(item.path))</div>
<div class="line">  .on(&#39;end&#39;, () =&gt; console.dir(items)) <span class="comment">// =&gt; [ ... array of files]</span></div>
</div><!-- fragment --><p><b>Streams 2 &amp; 3 (pull) example:</b></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> klaw = require(<span class="stringliteral">&#39;klaw&#39;</span>)</div>
<div class="line"> </div>
<div class="line">const items = [] <span class="comment">// files, directories, symlinks, etc</span></div>
<div class="line">klaw(&#39;/some/dir&#39;)</div>
<div class="line">  .on(&#39;readable&#39;, function () {</div>
<div class="line">    let item</div>
<div class="line">    <span class="keywordflow">while</span> ((item = this.read())) {</div>
<div class="line">      items.push(item.path)</div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line">  .on(<span class="stringliteral">&#39;end&#39;</span>, () =&gt; console.dir(items)) <span class="comment">// =&gt; [ ... array of files]</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md639"></a>
Error Handling</h2>
<p>Listen for the <code>error</code> event.</p>
<p>Example:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> klaw = require(<span class="stringliteral">&#39;klaw&#39;</span>)</div>
<div class="line"> </div>
<div class="line">klaw(&#39;/some/dir&#39;)</div>
<div class="line">  .on(&#39;readable&#39;, function () {</div>
<div class="line">    let item</div>
<div class="line">    <span class="keywordflow">while</span> ((item = this.read())) {</div>
<div class="line">      <span class="comment">// do something with the file</span></div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line">  .on(<span class="stringliteral">&#39;error&#39;</span>, (err, item) =&gt; {</div>
<div class="line">    console.log(err.message)</div>
<div class="line">    console.log(item.path) <span class="comment">// the file the error occurred on</span></div>
<div class="line">  })</div>
<div class="line">  .on(<span class="stringliteral">&#39;end&#39;</span>, () =&gt; console.dir(items)) <span class="comment">// =&gt; [ ... array of files]</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md640"></a>
Aggregation / Filtering / Executing Actions (Through Streams)</h2>
<p>On many occasions you may want to filter files based upon size, extension, etc. Or you may want to aggregate stats on certain file types. Or maybe you want to perform an action on certain file types.</p>
<p>You should use the module <a href="https://www.npmjs.com/package/through2"><code>through2</code></a> to easily accomplish this.</p>
<p>Install <code>through2</code>: </p><pre class="fragment">npm i --save through2
</pre><p><b>Example (skipping directories):</b></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> klaw = require(<span class="stringliteral">&#39;klaw&#39;</span>)</div>
<div class="line">const through2 = require(&#39;through2&#39;)</div>
<div class="line"> </div>
<div class="line">const excludeDirFilter = through2.obj(function (item, enc, next) {</div>
<div class="line">  <span class="keywordflow">if</span> (!item.stats.isDirectory()) this.push(item)</div>
<div class="line">  next()</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> items = [] <span class="comment">// files, directories, symlinks, etc</span></div>
<div class="line">klaw(<span class="stringliteral">&#39;/some/dir&#39;</span>)</div>
<div class="line">  .pipe(excludeDirFilter)</div>
<div class="line">  .on(<span class="stringliteral">&#39;data&#39;</span>, item =&gt; items.push(item.path))</div>
<div class="line">  .on(<span class="stringliteral">&#39;end&#39;</span>, () =&gt; console.dir(items)) <span class="comment">// =&gt; [ ... array of files without directories]</span></div>
</div><!-- fragment --><p><b>Example (ignore hidden directories):</b></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> klaw = require(<span class="stringliteral">&#39;klaw&#39;</span>)</div>
<div class="line">const path = require(&#39;path&#39;)</div>
<div class="line"> </div>
<div class="line">const filterFunc = item =&gt; {</div>
<div class="line">  <span class="keyword">const</span> basename = path.basename(item)</div>
<div class="line">  <span class="keywordflow">return</span> basename === <span class="charliteral">&#39;.&#39;</span> || basename[0] !== <span class="charliteral">&#39;.&#39;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">klaw(<span class="stringliteral">&#39;/some/dir&#39;</span>, { filter: filterFunc })</div>
<div class="line">  .on(<span class="stringliteral">&#39;data&#39;</span>, item =&gt; {</div>
<div class="line">    <span class="comment">// only items of none hidden folders will reach here</span></div>
<div class="line">  })</div>
</div><!-- fragment --><p><b>Example (totaling size of PNG files):</b></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> klaw = require(<span class="stringliteral">&#39;klaw&#39;</span>)</div>
<div class="line">const path = require(&#39;path&#39;)</div>
<div class="line">const through2 = require(&#39;through2&#39;)</div>
<div class="line"> </div>
<div class="line">let totalPngsInBytes = 0</div>
<div class="line">const aggregatePngSize = through2.obj(function (item, enc, next) {</div>
<div class="line">  <span class="keywordflow">if</span> (path.extname(item.path) === <span class="stringliteral">&#39;.png&#39;</span>) {</div>
<div class="line">    totalPngsInBytes += item.stats.size</div>
<div class="line">  }</div>
<div class="line">  this.push(item)</div>
<div class="line">  next()</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">klaw(<span class="stringliteral">&#39;/some/dir&#39;</span>)</div>
<div class="line">  .pipe(aggregatePngSize)</div>
<div class="line">  .on(<span class="stringliteral">&#39;data&#39;</span>, item =&gt; items.push(item.path))</div>
<div class="line">  .on(<span class="stringliteral">&#39;end&#39;</span>, () =&gt; console.dir(totalPngsInBytes)) <span class="comment">// =&gt; total of all pngs (bytes)</span></div>
</div><!-- fragment --><p><b>Example (deleting all .tmp files):</b></p>
<div class="fragment"><div class="line"><span class="keyword">const</span> fs = require(<span class="stringliteral">&#39;fs&#39;</span>)</div>
<div class="line">const klaw = require(&#39;klaw&#39;)</div>
<div class="line">const through2 = require(&#39;through2&#39;)</div>
<div class="line"> </div>
<div class="line">const deleteAction = through2.obj(function (item, enc, next) {</div>
<div class="line">  this.push(item)</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (path.extname(item.path) === <span class="stringliteral">&#39;.tmp&#39;</span>) {</div>
<div class="line">    item.deleted = <span class="keyword">true</span></div>
<div class="line">    fs.unlink(item.path, next)</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    item.deleted = <span class="keyword">false</span></div>
<div class="line">    next()</div>
<div class="line">  }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> deletedFiles = []</div>
<div class="line">klaw(<span class="stringliteral">&#39;/some/dir&#39;</span>)</div>
<div class="line">  .pipe(deleteAction)</div>
<div class="line">  .on(<span class="stringliteral">&#39;data&#39;</span>, item =&gt; {</div>
<div class="line">    <span class="keywordflow">if</span> (!item.deleted) <span class="keywordflow">return</span></div>
<div class="line">    deletedFiles.push(item.path)</div>
<div class="line">  })</div>
<div class="line">  .on(<span class="stringliteral">&#39;end&#39;</span>, () =&gt; console.dir(deletedFiles)) <span class="comment">// =&gt; all deleted files</span></div>
</div><!-- fragment --><p>You can even chain a bunch of these filters and aggregators together. By using multiple pipes.</p>
<p><b>Example (using multiple filters / aggregators):</b></p>
<div class="fragment"><div class="line">klaw(<span class="stringliteral">&#39;/some/dir&#39;</span>)</div>
<div class="line">  .pipe(filterCertainFiles)</div>
<div class="line">  .pipe(deleteSomeOtherFiles)</div>
<div class="line">  .on(<span class="stringliteral">&#39;end&#39;</span>, () =&gt; console.log(<span class="stringliteral">&#39;all done!&#39;</span>))</div>
</div><!-- fragment --><p><b>Example passing (piping) through errors:</b></p>
<p>Node.js does not <code>pipe()</code> errors. This means that the error on one stream, like <code>klaw</code> will not pipe through to the next. If you want to do this, do the following:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> klaw = require(<span class="stringliteral">&#39;klaw&#39;</span>)</div>
<div class="line">const through2 = require(&#39;through2&#39;)</div>
<div class="line"> </div>
<div class="line">const excludeDirFilter = through2.obj(function (item, enc, next) {</div>
<div class="line">  <span class="keywordflow">if</span> (!item.stats.isDirectory()) this.push(item)</div>
<div class="line">  next()</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> items = [] <span class="comment">// files, directories, symlinks, etc</span></div>
<div class="line">klaw(<span class="stringliteral">&#39;/some/dir&#39;</span>)</div>
<div class="line">  .on(<span class="stringliteral">&#39;error&#39;</span>, err =&gt; excludeDirFilter.emit(<span class="stringliteral">&#39;error&#39;</span>, err)) <span class="comment">// forward the error on</span></div>
<div class="line">  .pipe(excludeDirFilter)</div>
<div class="line">  .on(<span class="stringliteral">&#39;data&#39;</span>, item =&gt; items.push(item.path))</div>
<div class="line">  .on(<span class="stringliteral">&#39;end&#39;</span>, () =&gt; console.dir(items)) <span class="comment">// =&gt; [ ... array of files without directories]</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md641"></a>
Searching Strategy</h2>
<p>Pass in options for <code>queueMethod</code>, <code>pathSorter</code>, and <code>depthLimit</code> to affect how the file system is recursively iterated. See the code for more details, it's less than 50 lines :)</p>
<h1><a class="anchor" id="autotoc_md642"></a>
License</h1>
<p>MIT</p>
<p>Copyright (c) 2015 <a href="https://github.com/jprichardson">JP Richardson</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
